# Adjust pvalues for multiple testing by computing FDR
# FDR is computed using Benjaminiâ€“Hochberg method, R function - p.adjust
# Final results are saved to the folder results

############ Zratio FDR table ############
# 1. Index
# 2. Chromosome
# 3. Local Bin_Start
# 4. Local Bin_End
# 5. Local Bin Index
# 6. Regional Bin_Start
# 7. Regional Bin_End
# 8. Control Sample Z average
# 9. Treatment Sample Z average
# 10. Z difference
# 11. Z ratio
# 12. pvalue
# 13. adjusted pvalue (FDR)


## 1	chr1	3531501	3532000	chr1_7064	3510001	3535000	3.98129386851136	2.96420764154394	-1.01708622696742	-4.89396056120755	9.88266517541309e-07	0.000434001601177608
## 2	chr1	3531501	3532000	chr1_7064	3515001	3540000	3.9284857749013	2.95669941921803	-0.97178635568327	-4.6759890877825	2.92540162982937e-06	0.000961759333990234
## 3	chr1	3531501	3532000	chr1_7064	3520001	3545000	3.94236391997561	2.99136750888482	-0.95099641109079	-4.57595315552074	4.74056621923949e-06	0.00137664660021432
## 4	chr1	3531501	3532000	chr1_7064	3525001	3550000	3.82844691148087	2.91043017906113	-0.91801673241974	-4.4172633193417	9.99584289820234e-06	0.00240403376011464
## 5	chr1	3531501	3532000	chr1_7064	3530001	3555000	3.80198894965918	2.89530432420769	-0.90668462545149	-4.36273609922256	1.28445848716114e-05	0.00287678561796372
## 6	chr1	3670501	3671000	chr1_7342	3650001	3675000	-0.153388341266532	-0.223279503175188	-0.069891161908656	-0.336298517164848	0.736645768010362	1
## 7	chr1	3670501	3671000	chr1_7342	3655001	3680000	-0.150661314850463	-0.208132273756738	-0.057470958906275	-0.276535655330528	0.782136677909753	1
## 8	chr1	3670501	3671000	chr1_7342	3660001	3685000	-0.132963940204769	-0.186350919120976	-0.053386978916207	-0.256884581041825	0.797267873808637	1
## 9	chr1	3670501	3671000	chr1_7342	3665001	3690000	-0.078424321615886	-0.17159200807473	-0.093167686458844	-0.448299240535423	0.653937248675647	1

cd byChr

mkdir -p results

for f in *.zratio.pval.txt
do 
	fname=${f%.zratio.pval.txt}
	Rscript getFDR.R ${f} results/${fname}.txt
done

cd ..
